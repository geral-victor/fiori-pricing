<mvc:View controllerName="project1.controller.View1"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <content>
            <VBox id="mainVBox" class="sapUiSmallMargin">
                <HBox id="searchHBox" alignItems="Center" class="sapUiSmallMarginBottom">
                    <Input 
                        id="componentInput" 
                        placeholder="Enter component query (e.g., Manufacturer MPN or just MPN)"
                        width="400px"
                        submit=".onSearch"
                        class="sapUiSmallMarginEnd"/>
                    <Button 
                        id="searchButton" 
                        text="Search" 
                        type="Emphasized"
                        press=".onSearch"
                        enabled="{= !${componentData>/loading}}"/>
                </HBox>
                
                <Table 
                    id="resultsTable" 
                    items="{componentData>/results}"
                    visible="{= ${componentData>/results}.length > 0}"
                    growing="true"
                    growingThreshold="20">
                    <headerToolbar>
                        <OverflowToolbar id="resultsToolbar">
                            <Title id="resultsTitle" text="Component Search Results" level="H2"/>
                            <ToolbarSpacer id="toolbarSpacer"/>
                            <Label id="quantityLabel" text="Required Quantity:" class="sapUiSmallMarginEnd"/>
                            <Input 
                                id="requiredQuantityInput" 
                                placeholder="Enter quantity"
                                width="150px"
                                type="Number"
                                value="{componentData>/requiredQuantity}"
                                liveChange=".onQuantityChange"/>
                        </OverflowToolbar>
                    </headerToolbar>
                    <columns>
                        <Column id="imageColumn" width="5em" minScreenWidth="Desktop" demandPopin="true">
                            <Text id="imageHeader" text="Image"/>
                        </Column>
                        <Column id="supplierColumn" width="6em">
                            <Text id="supplierHeader" text="Supplier"/>
                        </Column>
                        <Column id="skuColumn" width="8em" minScreenWidth="Tablet" demandPopin="true">
                            <Text id="skuHeader" text="SKU"/>
                        </Column>
                        <Column id="manufacturerColumn" width="7em" minScreenWidth="Tablet" demandPopin="true">
                            <Text id="manufacturerHeader" text="Manufacturer"/>
                        </Column>
                        <Column id="mpnColumn" width="7em" minScreenWidth="Desktop" demandPopin="true">
                            <Text id="mpnHeader" text="MPN"/>
                        </Column>
                        <Column id="descriptionColumn" width="10em" minScreenWidth="Desktop" demandPopin="true">
                            <Text id="descriptionHeader" text="Description"/>
                        </Column>
                        <Column id="packagingColumn" width="5em" minScreenWidth="Tablet" demandPopin="true">
                            <Text id="packagingHeader" text="Package"/>
                        </Column>
                        <Column id="stockColumn" width="5em" minScreenWidth="Tablet" demandPopin="true" hAlign="End">
                            <Text id="stockHeader" text="Stock"/>
                        </Column>
                        <Column id="moqColumn" width="4em" minScreenWidth="Tablet" demandPopin="true" hAlign="End">
                            <Text id="moqHeader" text="MOQ"/>
                        </Column>
                        <Column id="mpqColumn" width="4em" minScreenWidth="Tablet" demandPopin="true" hAlign="End">
                            <Text id="mpqHeader" text="MPQ"/>
                        </Column>
                        <Column id="pricingColumn" width="12em" minScreenWidth="Desktop" demandPopin="true">
                            <Text id="pricingHeader" text="Pricing Tiers"/>
                        </Column>
                        <Column id="unitColumn" width="5em" minScreenWidth="Tablet" demandPopin="true">
                            <Text id="unitHeader" text="Unit"/>
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem id="resultItem">
                            <customData>
                                <core:CustomData key="highlight" value="{componentData>highlight}" writeToDom="true" />
                            </customData>
                            <cells>
                                <Image id="productImage" 
                                    src="{componentData>imageUrl}" 
                                    width="3rem"
                                    densityAware="false"
                                    visible="{= !!${componentData>imageUrl}}"/>
                                <Text id="supplierText" text="{componentData>supplier}"/>
                                <Link id="skuLink" 
                                    text="{componentData>sku}" 
                                    href="{componentData>url}"
                                    target="_blank"
                                    enabled="{= !!${componentData>url}}"/>
                                <Text id="manufacturerText" text="{componentData>manufacturer}"/>
                                <FormattedText id="mpnFormattedText" htmlText="{
                                    parts: [
                                        {path: 'componentData>mpn'},
                                        {path: 'componentData>inferredMpn'}
                                    ],
                                    formatter: '.formatMpnWithHighlight'
                                }"/>
                                <Text id="descriptionText" text="{componentData>description}"/>
                                <VBox id="packagingBox">
                                    <BusyIndicator id="packagingBusy" 
                                        size="1rem" 
                                        visible="{componentData>pricingLoading}"/>
                                    <Text id="packagingText" 
                                        text="{componentData>packaging}"
                                        visible="{= !${componentData>pricingLoading} &amp;&amp; !${componentData>pricingError}}"/>
                                </VBox>
                                <VBox id="stockBox">
                                    <BusyIndicator id="stockBusy" 
                                        size="1rem" 
                                        visible="{componentData>pricingLoading}"/>
                                    <Text id="stockText" 
                                        text="{componentData>pricing/availability/0/quantity}"
                                        visible="{= !${componentData>pricingLoading} &amp;&amp; !${componentData>pricingError}}"/>
                                    <Text id="stockError" 
                                        text="Error"
                                        visible="{= !${componentData>pricingLoading} &amp;&amp; !!${componentData>pricingError}}"
                                        class="sapUiTinyMarginTop"/>
                                </VBox>
                                <VBox id="moqBox">
                                    <BusyIndicator id="moqBusy" 
                                        size="1rem" 
                                        visible="{componentData>pricingLoading}"/>
                                    <Text id="moqText" 
                                        text="{componentData>moq}"
                                        visible="{= !${componentData>pricingLoading} &amp;&amp; !${componentData>pricingError}}"/>
                                </VBox>
                                <VBox id="mpqBox">
                                    <BusyIndicator id="mpqBusy" 
                                        size="1rem" 
                                        visible="{componentData>pricingLoading}"/>
                                    <Text id="mpqText" 
                                        text="{componentData>mpq}"
                                        visible="{= !${componentData>pricingLoading} &amp;&amp; !${componentData>pricingError}}"/>
                                </VBox>
                                <VBox id="pricingBox">
                                    <BusyIndicator id="pricingBusy" 
                                        size="1rem" 
                                        visible="{componentData>pricingLoading}"/>
                                    <List id="tiersList"
                                        visible="{= !${componentData>pricingLoading} &amp;&amp; !${componentData>pricingError}}"
                                        showNoData="false"
                                        class="sapUiTinyMarginTop"
                                        items="{
                                            path: 'componentData>pricing/pricing',
                                            templateShareable: false
                                        }">
                                        <items>
                                            <CustomListItem id="tierItem" class="sapUiSmallMarginBottom">
                                                <customData>
                                                    <core:CustomData key="applicable" value="{componentData>isApplicable}" writeToDom="true" />
                                                </customData>
                                                <HBox id="tierBox" alignItems="Center" class="sapUiTinyPadding">
                                                    <Text id="tierQty" text="{componentData>minQuantity}+" class="sapUiSmallMarginEnd" width="3rem"/>
                                                    <Text id="tierPrice" text="{
                                                        parts: [
                                                            {path: 'componentData>price'},
                                                            {path: 'componentData>currency'}
                                                        ],
                                                        formatter: '.formatPrice'
                                                    }" renderWhitespace="true"/>
                                                </HBox>
                                            </CustomListItem>
                                        </items>
                                    </List>
                                    <Text id="pricingErrorText" 
                                        text="{componentData>pricingError}"
                                        visible="{= !${componentData>pricingLoading} &amp;&amp; !!${componentData>pricingError}}"
                                        class="sapUiTinyMarginTop"/>
                                </VBox>
                                <VBox id="unitBox">
                                    <BusyIndicator id="unitBusy" 
                                        size="1rem" 
                                        visible="{componentData>pricingLoading}"/>
                                    <Text id="unitText" 
                                        text="{componentData>unitNormalized}"
                                        visible="{= !${componentData>pricingLoading} &amp;&amp; !${componentData>pricingError}}"/>
                                </VBox>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </VBox>
        </content>
    </Page>
</mvc:View>